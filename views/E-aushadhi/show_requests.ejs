<!DOCTYPE html>
<html>
  <head>
    <title>Show Requests</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
      }

      .clearfix {
        clear: both;
      }

      .header-banner {
        /* padding-top: 35px; */
        padding-bottom: 10px;
        height: 25vh;
        width: 100%;
        color: #ffffff;
        position: fixed;
        z-index: 3;
        top: 0;
        font-family: Helvetica, serif;
        font-weight: 100;
        background-attachment: scroll, scroll;
        background-position: left top, center center;
        background-repeat: repeat-y, no-repeat;
        background-size: contain, cover;
      }

      .container-width {
        background-color: #a9d3e7;
        width: 100%;
        /* max-width: 1150px; */
        /* margin: 0 auto; */
      }

      .logo-container {
        float: left;
        width: 50%;
        height: 100%;
      }

      .logo {
        background-color: #a9d3e7;
        border-radius: 5px;
        height: 4px;
        width: 1px;
        padding: 10px;
        min-height: 30px;
        text-align: center;
        line-height: 30px;
        color: #000000;
        font-size: 23px;
      }

      .menu {
        float: right;
        width: 50%;
        padding-right: 70;
      }

      .menu-item {
        float: right;
        font-size: 17px;
        color: black;
        width: 400px;
        padding: 10px;
        min-height: 50px;
        text-align: center;
        line-height: 30px;
        font-weight: 300;
        padding-right: 70;
      }

      .am-sect {
        padding-top: 10px;
        padding-bottom: 100px;
        font-family: Helvetica, serif;
      }

      .container-width {
        width: 100%;
        /* max-width: 1150px; */
        /* margin: 0 auto; */
      }

      .img-phone {
        float: left;
      }

      .am-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }

      #izag5 {
        width: 500px;
      }

      .am-content {
        float: center;
        padding: 7px;
        width: 550px;
        color: #444;
        font-weight: 100;
        margin-top: 5px;
      }

      .am-title {
        padding: 7px;
        font-size: 55px;
        font-weight: 300;
      }

      .am-desc {
        padding: 7px;
        font-size: 17px;
        line-height: 25px;
      }

      .am-post {
        padding: 7px;
        line-height: 25px;
        font-size: 13px;
      }

      #i28v {
        opacity: 1;
        background-repeat: no-repeat;
        background-position: center center;
        background-attachment: scroll;
      }

      #i9wk {
        width: 600px;
      }

      .footer {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        padding: 10px;
        background-color: #cce70b;
        color: #041e3f;
        text-align: center;
        font-weight: bold;
      }
      body {
        font-family: Arial, sans-serif;
        background-color: #f2f2f2;
        margin: 0;
        padding: 0;
      }

      h1 {
        text-align: center;
        margin-top: 50px;
        color: #333;
      }

      .container {
        display: block;
        justify-content: center;
        align-items: center;
        margin-top: 50px;
      }

      table {
        align-items: center;
        border-collapse: collapse;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        margin: auto;
      }

      table th {
        background-color: #333;
        color: #fff;
        padding: 10px;
        text-align: left;
      }

      table td {
        border: 1px solid #ddd;
        padding: 10px;
        font-size: 14px;
        color: #333;
      }

      table td:nth-child(odd) {
        background-color: #f2f2f2;
      }

      table td:last-child {
        text-align: center;
      }

      .table-title {
        text-align: center;
        font-size: 24px;
        margin-bottom: 20px;
        color: #333;
      }
      .table-container {
        align-items: center;
      }
      .card {
        margin: auto 100px;
      }

      .approve-btn {
        margin: none;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        font-size: 16px;
        background-color: #3498db;
        color: #fff;
        cursor: pointer;
        align-self: center;
      }
    </style>
  </head>
  <body>
    <div class="header-banner" id="i28v">
      <div class="container-width" id="iv52">
        <div class="logo-container" id="i8pl">
          <div class="logo" id="i9wk">
            <img
              src="../images/khfwd.png"
              alt="Dept. of Health and Familiy Welfare Services"
              style="width: 100px; height: 90px"
            />
            <br />
            <span style="font-size: 19px; font-weight: bold; color: red"
              >Dept. of Health and Family Welfare Services</span
            >
          </div>
        </div>
        <nav class="menu" id="i52r">
          <div class="menu-item" id="ie64">
            <img
              src="../images/iiitlogo.png"
              alt="Indian Institute of Information Technology, Dharwad"
              style="width: 300px; height: 86px"
            />

            <span style="font-weight: bold; color: #041e3f"
              >Knowledge Partner to Dept. of Health and Family Welfare
              Services</span
            >
          </div>
        </nav>
        <div class="clearfix"></div>
      </div>
    </div>
    <div style="height: 200"></div>
    <div class="container" style="margin: 200px auto">
      <div class="table-container">
        <h2 class="table-title">Requests</h2>
        <table id="eaushadhi-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Price</th>
              <th>Quantity</th>
              <th>Reciept Cost</th>
              <th>Reciept Date</th>
              <th>Remaining Quantity</th>
              <th>Hospital ID</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% for (let i = 0; i < data.length; i++) { %>
            <tr id="row<%= i %>">
              <td id="row<%= i %>d0"><%= data[i].name %></td>
              <td id="row<%= i %>d1"><%= data[i].Drug_ID %></td>
              <td id="row<%= i %>d2"><%= data[i].Price %></td>
              <td id="row<%= i %>d3"><%= data[i].Quantity %></td>
              <td id="row<%= i %>d4"><%= data[i].cost %></td>
              <td id="row<%= i %>d5"><%= data[i].RDate %></td>
              <td id="row<%= i %>d6"><%= data[i].Remaining %></td>
              <td id="row<%= i %>d7"><%= data[i].hospid %></td>
              <td>
                <button class="approve-btn" data-row="<%= i %>">Approve</button>
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
      <br /><br />
      <div class="card">
        <h2><a href="/">Home</a></h2>
      </div>
      <div class="card">
        <h2><a href="/eaushadhi">Back</a></h2>
      </div>
      <br /><br />
      <div class="card">
        <p>Last Updated on: <%= dnt %></p>
      </div>
    </div>

    <script>
      const approveButtons = document.querySelectorAll(".approve-btn");
      approveButtons.forEach((button) => {
        button.addEventListener("click", () => {
          const rowIndex = button.dataset.row;
          const row = document.querySelector(`#row${rowIndex}`);
          const rowData = {
            drugid: document.querySelector(`#row${rowIndex}d0`).textContent,
            drugname: document.querySelector(`#row${rowIndex}d1`).textContent,
            price: document.querySelector(`#row${rowIndex}d2`).textContent,
            quantity: document.querySelector(`#row${rowIndex}d3`).textContent,
            cost: document.querySelector(`#row${rowIndex}d4`).textContent,
            rdate: document
              .querySelector(`#row${rowIndex}d5`)
              .textContent.trim(),
            rem: document.querySelector(`#row${rowIndex}d6`).textContent,
            hospid: document.querySelector(`#row${rowIndex}d7`).textContent,
          };
          fetch("/eaushadhi/requests/approve", {
            method: "POST",
            body: JSON.stringify(rowData),
            headers: {
              "Content-Type": "application/json",
            },
          })
            .then((response) => {
              if (response.ok) {
                row.remove();
              } else {
                throw new Error("Failed to approve request");
              }
            })
            .catch((error) => {
              console.error(error);
              alert("Failed to approve request");
            });
        });
      });
    </script>
  </body>
</html>
